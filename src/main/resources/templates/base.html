<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <script>
        const refreshToken = '[[${refreshToken}]]'; // 서버에서 전달된 리프레시 토큰
        const email = '[[${email}]]'; // 사용자 이메일

        function checkAndRefreshToken() {
            fetch('/api/protected-endpoint', {
                method: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + localStorage.getItem('accessToken')
                }
            }).then(response => {
                if (response.status === 401) { // 액세스 토큰이 만료됨
                    refreshAccessToken();
                }
            }).catch(error => {
                console.error('토큰 확인 중 오류 발생:', error);
            });
        }

        function refreshAccessToken() {
            fetch('/api/user/refresh-token', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `email=${email}&refreshToken=${refreshToken}`
            }).then(response => response.json())
                .then(data => {
                    localStorage.setItem('accessToken', data.accessToken); // 새 액세스 토큰 저장
                    console.log("새로운 액세스 토큰 발급 완료:", data.accessToken);
                })
                .catch(error => console.error('리프레시 토큰 재발급 중 오류 발생:', error));
        }

        // 페이지 로드 시 또는 주기적으로 토큰 확인
        setInterval(checkAndRefreshToken, 5 * 60 * 1000); // 5분마다 확인
    </script>
</head>
<body>
<header>
    <!-- 헤더 공통 영역 -->
</header>
<main>
    <div th:insert="~{::body}"></div>
</main>
<footer>
    <!-- 푸터 공통 영역 -->
</footer>
</body>
</html>
